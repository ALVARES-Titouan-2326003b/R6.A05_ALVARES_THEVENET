{% extends 'base.html.twig' %}

{% block title %}Accueil - EduLearn{% endblock %}

{% block body %}
    <!-- HERO SECTION -->
    <div class="hero">
        <div class="container">
            <h1>Plateforme d'Apprentissage Moderne</h1>
            <p>Acc√©dez √† vos cours, regardez des vid√©os, consultez des documents et passez des QCM g√©n√©r√©s par IA</p>
            <div class="stats">
                <div class="stat-item">
                    <div class="stat-number">150+</div>
                    <div class="stat-label">Cours disponibles</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">2,500+</div>
                    <div class="stat-label">√âtudiants actifs</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">98%</div>
                    <div class="stat-label">Taux de satisfaction</div>
                </div>
            </div>
        </div>
    </div>

    <div class="container my-5">
        <!-- CAROUSEL VID√âOS -->
        <div class="card mb-5">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">üìπ Vid√©os de Cours</h2>
                    <div class="carousel-controls">
                        <button class="carousel-btn" onclick="scrollCarousel('videos-carousel', -320)">‚Üê</button>
                        <button class="carousel-btn" onclick="scrollCarousel('videos-carousel', 320)">‚Üí</button>
                    </div>
                </div>

                <div class="row flex-nowrap overflow-auto pb-3" id="videos-carousel" style="scroll-behavior: smooth;">
                    {% if videos is empty %}
                        <div class="col-12">
                            <div class="alert alert-info text-center">
                                <p class="mb-0">Aucune vid√©o disponible pour le moment.</p>
                            </div>
                        </div>
                    {% else %}
                        {% for video in videos %}
                            <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-3">
                                <div class="card h-100">
                                    <!-- Thumbnail vid√©o -->
                                    <div class="carousel-item-video position-relative">
                                        üé¨
                                        <div class="position-absolute" style="width: 60px; height: 60px; background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: var(--primary);">
                                            ‚ñ∂
                                        </div>
                                    </div>
                                    
                                    <!-- Contenu -->
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold">{{ video.title }}</h5>
                                        <p class="card-text text-muted small mb-3">
                                            {{ video.description|length > 80 ? video.description|slice(0, 80) ~ '...' : video.description }}
                                        </p>
                                        
                                        <!-- Boutons d'action -->
                                        {% if is_granted('ROLE_TEACHER') %}
                                            <button class="btn btn-success-custom mb-2" onclick="generateQCM('video', {{ video.id }})">
                                                ü§ñ G√©n√©rer QCM (Prof)
                                            </button>
                                        {% endif %}
                                        
                                        <a href="#" class="btn btn-primary-custom" onclick="takeQCM(event, '{{ video.title }}')">
                                            ‚úèÔ∏è Passer le QCM
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- CAROUSEL DOCUMENTS -->
        <div class="card mb-5">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">üìÑ Documents de Cours</h2>
                    <div class="carousel-controls">
                        <button class="carousel-btn" onclick="scrollCarousel('documents-carousel', -320)">‚Üê</button>
                        <button class="carousel-btn" onclick="scrollCarousel('documents-carousel', 320)">‚Üí</button>
                    </div>
                </div>

                <div class="row flex-nowrap overflow-auto pb-3" id="documents-carousel" style="scroll-behavior: smooth;">
                    {% if documents is empty %}
                        <div class="col-12">
                            <div class="alert alert-info text-center">
                                <p class="mb-0">Aucun document disponible pour le moment.</p>
                            </div>
                        </div>
                    {% else %}
                        {% for document in documents %}
                            <div class="col-12 col-md-6 col-lg-4 col-xl-3 mb-3">
                                <div class="card h-100">
                                    <!-- Thumbnail document -->
                                    <div class="carousel-item-document">
                                        üìë
                                    </div>
                                    
                                    <!-- Contenu -->
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold">{{ document.title }}</h5>
                                        <p class="card-text text-muted small mb-3">
                                            {{ document.description|length > 80 ? document.description|slice(0, 80) ~ '...' : document.description }}
                                        </p>
                                        
                                        <!-- Boutons d'action -->
                                        {% if is_granted('ROLE_TEACHER') %}
                                            <button class="btn btn-success-custom mb-2" onclick="generateQCM('document', {{ document.id }})">
                                                ü§ñ G√©n√©rer QCM (Prof)
                                            </button>
                                        {% endif %}
                                        
                                        <a href="#" class="btn btn-primary-custom" onclick="takeQCM(event, '{{ document.title }}')">
                                            ‚úèÔ∏è Passer le QCM
                                        </a>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- SECTION R√âSULTATS (optionnel, √† garder pour plus tard) -->
        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2 class="mb-0">üìä Mes R√©sultats</h2>
                    <button class="btn btn-success" onclick="exportResults()">
                        üì• Exporter en CSV
                    </button>
                </div>

                <div class="alert alert-info text-center">
                    <p class="mb-0">Vous n'avez pas encore pass√© de QCM. Commencez d√®s maintenant ! üöÄ</p>
                </div>

                {# Table des r√©sultats - √† impl√©menter plus tard
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-primary">
                            <tr>
                                <th>QCM</th>
                                <th>Date</th>
                                <th>Score</th>
                                <th>Note</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="5" class="text-center py-4">
                                    Aucun r√©sultat disponible
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                #}
            </div>
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    
    <script>
        // Fonction pour faire d√©filer les carrousels
        function scrollCarousel(id, amount) {
            const carousel = document.getElementById(id);
            carousel.scrollBy({ left: amount, behavior: 'smooth' });
        }

        // Fonction pour g√©n√©rer un QCM (Professeur)
        function generateQCM(type, id) {
            const confirmMsg = `Voulez-vous g√©n√©rer un QCM automatique pour ce ${type === 'video' ? 'vid√©o' : 'document'} ?`;
            
            if (confirm(confirmMsg)) {
                // Animation de chargement
                const btn = event.target;
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '‚è≥ G√©n√©ration...';
                btn.disabled = true;
                
                // Simulation - √† remplacer par un vrai appel AJAX
                setTimeout(() => {
                    btn.innerHTML = '‚úÖ QCM Cr√©√© !';
                    btn.classList.remove('btn-success-custom');
                    btn.classList.add('btn-success');
                    
                    setTimeout(() => {
                        btn.innerHTML = originalHTML;
                        btn.disabled = false;
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-success-custom');
                    }, 2000);
                    
                    alert('QCM g√©n√©r√© avec succ√®s ! üéâ\n\n‚Ä¢ 10 questions cr√©√©es\n‚Ä¢ Difficult√© progressive\n‚Ä¢ Disponible pour les √©tudiants');
                }, 2000);
            }
        }

        // Fonction pour passer un QCM (√âtudiant)
        function takeQCM(event, courseName) {
            event.preventDefault();
            
            alert(`üéì D√©marrage du QCM : ${courseName}\n\n‚úì 10 questions\n‚úì Dur√©e : 20 minutes\n‚úì Note sur 20\n\nBonne chance ! üçÄ`);
            
            // Simulation - √† remplacer par une vraie redirection
            // window.location.href = '/qcm/' + qcmId + '/start';
        }

        // Fonction pour exporter les r√©sultats
        function exportResults() {
            alert('Export CSV en cours... üì•\n\nLes r√©sultats seront t√©l√©charg√©s dans quelques secondes.');
            // √Ä impl√©menter : vraie exportation CSV
        }
    </script>
{% endblock %}
